# FFmpeg获取视频首帧转封面图Bitmap

这是学习ffmpeg的第二篇博客，主要是使用ffmpeg获取本地视频文件的第一帧数据转换为Bitmap，然后抛给上层ImageView显示。

大致流程可以分为：

1. 传入视频文件路径，解封装
2. 找到视频流，从流中找到解码器
3. 打开解码器，读取第一个完整的AVFrame帧
4. 创建bitmap，使用libyuv将yuv转为rgb关联给bitmap
5. 释放资源

## 先定义jni函数

```java
public static native Bitmap getCover(String path);
```

```c++
JNIEXPORT jobject JNICALL
Java_demo_simple_example_1ffmpeg_MainActivity_getCover(JNIEnv *env,
                                                       jclass clazz,
                                                       jstring path) {
  const char *_path = env->GetStringUTFChars(path, JNI_FALSE);
  int ret = -1;
}
```

## 打开视频文件，解封装

```c++
AVFormatContext *ifmt_ctx = NULL;
    ret = avformat_open_input(&ifmt_ctx, _path, 0, 0);
    if (ret < 0) {
        logDebug("解封装失败 -- %s", av_err2str(ret));
        return nullptr;
    }
```

